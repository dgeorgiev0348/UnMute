<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{url_for('static',filename='dist/css/output.css')}}">
    <title>UnMute</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
</head>

<body class="bg-gray-900">

    <div class="flex items-center justify-center sticky top-0" id="title">
        <h1 class="font-sans text-6xl mt-7 font-extrabold text-blue-400 font-outline-2">UnMute</h1>
    </div>

    <a href="{{ url_for('home') }}" class="p-5 text-xl text-blue-400">< Back</a>

    <div class="flex flex-col items-center justify-center">
        <h1 class="font-sans text-3xl mt-7 font-extrabold text-blue-400">{{ title }}</h1>
        <h2 class="font-sans text-xl mt-7 mb-5 font-extrabold text-white">{{ description }}</h2>

        <!-- w-4/5 sm:w-1/3 bg-white border-4 border-sky-400 m-5  -->
        <video id="input_video" autoplay="true" class="hidden"></video>
        <canvas id="output_canvas" width="960px" height="540px"></canvas>
        <p id='gesture_output' class="output"></p>

        <label for="answer" class="text-3xl text-yellow-400">Answer: </label>
        <input name="answer" id="answer" class="w-96 text-xl text-center mb-2">

        <button class="text-xl bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">Submit</button>
    </div>

    <script type="module">
        const videoElement = document.getElementById('input_video');
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const gestureOutput = document.getElementById("gesture_output");
        
        function onResults(results) {
          canvasCtx.save();
          canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
          canvasCtx.drawImage(
              results.image, 0, 0, canvasElement.width, canvasElement.height);
          if (results.multiHandLandmarks) {
            for (const landmarks of results.multiHandLandmarks) {
              drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS,
                             {color: '#00FF00', lineWidth: 5});
              drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 2});
            }
          }
          canvasCtx.restore();
        }
        
        const hands = new Hands({locateFile: (file) => {
          return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
        }});
          
        hands.setOptions({
          maxNumHands: 2,
          modelComplexity: 1,
          minDetectionConfidence: 0.5,
          minTrackingConfidence: 0.5
        });
        hands.onResults(onResults);
        
        const camera = new Camera(videoElement, {
          onFrame: async () => {
            await hands.send({image: videoElement});
          },
          width: 1280,
          height: 720
        });
        camera.start();
    </script>
    

    <footer class="flex items-center justify-center bg-blue-400 fixed bottom-0 w-screen">
        <a class="text-lg text-white m-5" href="#">About us</a>
        <a class="text-lg text-white m-5" href="#">Help and Support</a>
        <a class="text-lg text-white m-5" href="#">Social</a>
    </footer>
</body>